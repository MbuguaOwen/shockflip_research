# ShockFlip_BTC_v1.6 – BTC spec (H1 + H2 extreme-only + BE + trailing option)

data:
  include: data.yaml

slippage_bp: 0.5
fees:
  taker_bp: 1.0

risk:
  atr_window: 60
  cooldown_bars: 10
  long:
    tp_mult: 27.5
    sl_mult: 4.5      # was 9.0 → SL cut in half
  short:
    tp_mult: 15.0
    sl_mult: 3.25     # was 6.5 → SL cut in half

  # Management: move SL to breakeven after decent MFE
  mfe_breakeven:
    enabled: true
    threshold_r: 0.5  # try 1.0 / 1.2 / 1.4 via small grid

  # New: configurable trailing stop in R-space (default OFF)
  trailing_stop:
    enabled: false          # default OFF so we can test cleanly
    arm_threshold_r: 3.0    # arm trailing once best MFE ≥ 3R
    floor_r: 2.5            # never give back below 2.5R once armed
    gap_r: 1.0              # trail ~1R behind best MFE

shock_flip:
  source: "imbalance"
  z_window: 240
  # Detection core from v1.3
  z_band: 1.8
  jump_band: 2.0
  persistence_bars: 3
  persistence_ratio: 0.60
  dynamic_thresholds:
    enabled: true
    percentile: 0.99
  location_filter:
    donchian_window: 120
    require_extreme: true

filters:
  # H1: Prior flow sign gate
  prior_flow_sign:
    enabled: true
    required_sign: -1

  # H2: Price/flow divergence – extreme-only lane
  price_flow_div:
    enabled: true
    mode: extreme_only
    threshold: 1.05

  # Optional ATR regime filter (disabled by default)
  atr_percentile:
    enabled: true
    window: 5000
    low: 0.80
    high: 1.00
  macro_regime:
    enabled: false

session:
  utc_blocks: [[0, 24]]

event_study:
  horizons:
    long:  [12, 18, 60]
    short: [6, 12]
  baseline_n_random: 2000

